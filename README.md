# API приложения Твой рацион

## Содержание
1. [Введение](#введение)
2. [Аутентификация](#аутентификация)
3. [Пользователи](#пользователи)
4. [Рецепты](#рецепты)
5. [Посты](#посты)
6. [Обработка ошибок](#обработка-ошибок)
7. [Логика приложения](#логика-приложения)
8. [Часто задаваемые вопросы](#часто-задаваемые-вопросы)
9. [Рекомендации по использованию API](#рекомендации-по-использованию-api)

## Введение

Данная методичка описывает API endpoints и логику работы приложения для диеты и обмена рецептами. API построено с использованием FastAPI и следует принципам REST.

**Базовый URL**: `http://83.166.233.215`

**Версия API**: v1

**Формат данных**: JSON

## Аутентификация

API использует JWT (JSON Web Tokens) для аутентификации.

### Регистрация нового пользователя

- **Endpoint**: `POST /auth/register`
- **Тело запроса**:
  ```json
  {
    "phone": "+79123456789",
    "password": "ваш_пароль",
    "nickname": "ваш_никнейм"
  }
  ```
- **Пример ответа**:
  ```json
  {
    "user": {
      "id": 1,
      "phone": "+79123456789",
      "nickname": "ваш_никнейм",
      "name": null,
      "age": null,
      "weight": null,
      "height": null,
      "gender": null,
      "activity_level": null,
      "allergies": null
    },
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "token_type": "bearer"
  }
  ```

### Вход в систему

- **Endpoint**: `POST /auth/token`
- **Тело запроса**:
  ```json
  {
    "username": "+79123456789",
    "password": "ваш_пароль"
  }
  ```
- **Пример ответа**:
  ```json
  {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "token_type": "bearer"
  }
  ```

Для всех аутентифицированных запросов включайте токен в заголовок Authorization:
```
Authorization: Bearer <ваш_токен>
```

## Пользователи

### Получение информации о текущем пользователе

- **Endpoint**: `GET /users/me`
- **Аутентификация**: Требуется
- **Пример ответа**:
  ```json
  {
    "id": 1,
    "phone": "+79123456789",
    "nickname": "ваш_никнейм",
    "name": "Иван Иванов",
    "age": 30,
    "weight": 70.5,
    "height": 175.0,
    "gender": "male",
    "activity_level": "moderate",
    "allergies": "lactose, peanuts"
  }
  ```

### Обновление информации о пользователе

- **Endpoint**: `PATCH /users/me`
- **Аутентификация**: Требуется
- **Тело запроса** (все поля опциональны):
  ```json
  {
    "nickname": "новый_никнейм",
    "name": "Новое Имя",
    "age": 31,
    "weight": 71.0,
    "height": 176.0,
    "gender": "male",
    "activity_level": "high",
    "allergies": "lactose, peanuts, gluten"
  }
  ```
- **Пример ответа**: Такой же, как и при получении информации о пользователе

## Рецепты

### Создание рецепта

- **Endpoint**: `POST /recipes/`
- **Аутентификация**: Требуется
- **Тело запроса**:
  ```json
  {
    "name": "Салат Цезарь",
    "description": "Классический салат Цезарь с курицей",
    "image_url": "http://example.com/caesar_salad.jpg",
    "ingredients": "Курица, салат романо, гренки, соус Цезарь, пармезан",
    "cost": 250.0,
    "calories": 350,
    "protein": 25,
    "fat": 20,
    "carbohydrates": 10,
    "category": "Салаты",
    "cooking_time": 20,
    "instructions": "1. Приготовить курицу. 2. Нарезать салат. 3. Смешать ингредиенты. 4. Добавить соус и посыпать сыром."
  }
  ```
- **Пример ответа**:
  ```json
  {
    "id": 1,
    "name": "Салат Цезарь",
    "description": "Классический салат Цезарь с курицей",
    "image_url": "http://example.com/caesar_salad.jpg",
    "ingredients": "Курица, салат романо, гренки, соус Цезарь, пармезан",
    "cost": 250.0,
    "calories": 350,
    "protein": 25,
    "fat": 20,
    "carbohydrates": 10,
    "category": "Салаты",
    "cooking_time": 20,
    "instructions": "1. Приготовить курицу. 2. Нарезать салат. 3. Смешать ингредиенты. 4. Добавить соус и посыпать сыром.",
    "user_id": 1
  }
  ```

### Получение рецепта

- **Endpoint**: `GET /recipes/{recipe_id}`
- **Пример ответа**: Такой же, как и при создании рецепта

### Обновление рецепта

- **Endpoint**: `PUT /recipes/{recipe_id}`
- **Аутентификация**: Требуется (должен быть автором рецепта)
- **Тело запроса**: Такое же, как при создании рецепта, все поля опциональны
- **Пример ответа**: Такой же, как и при создании рецепта

### Удаление рецепта

- **Endpoint**: `DELETE /recipes/{recipe_id}`
- **Аутентификация**: Требуется (должен быть автором рецепта)
- **Ответ**: 204 No Content

### Список рецептов

- **Endpoint**: `GET /recipes/`
- **Параметры запроса**:
  - `skip`: Количество рецептов для пропуска (по умолчанию 0)
  - `limit`: Максимальное количество рецептов для возврата (по умолчанию 100)
- **Пример ответа**:
  ```json
  [
    {
      "id": 1,
      "name": "Салат Цезарь",
      "description": "Классический салат Цезарь с курицей",
      "image_url": "http://example.com/caesar_salad.jpg",
      "ingredients": "Курица, салат романо, гренки, соус Цезарь, пармезан",
      "cost": 250.0,
      "calories": 350,
      "protein": 25,
      "fat": 20,
      "carbohydrates": 10,
      "category": "Салаты",
      "cooking_time": 20,
      "instructions": "1. Приготовить курицу. 2. Нарезать салат. 3. Смешать ингредиенты. 4. Добавить соус и посыпать сыром.",
      "user_id": 1
    },
    // ... другие рецепты
  ]
  ```

### Поиск рецептов

- **Endpoint**: `GET /recipes/search`
- **Параметры запроса**:
  - `name`: Поиск по названию рецепта
  - `ingredients`: Поиск по ингредиентам (через запятую)
  - `category`: Поиск по категории
- **Пример запроса**: `/recipes/search?name=салат&ingredients=курица,сыр&category=Салаты`
- **Пример ответа**: Такой же, как и при получении списка рецептов

### Получение категорий рецептов

- **Endpoint**: `GET /recipes/categories`
- **Пример ответа**:
  ```json
  [
    "Салаты",
    "Супы",
    "Горячие блюда",
    "Десерты"
  ]
  ```

## Посты

### Создание поста

- **Endpoint**: `POST /posts/`
- **Аутентификация**: Требуется
- **Тело запроса**:
  ```json
  {
    "title": "Мой опыт приготовления салата Цезарь",
    "content": "Сегодня я приготовил салат Цезарь по рецепту с этого сайта. Получилось очень вкусно!",
    "image_url": "http://example.com/my_caesar_salad.jpg"
  }
  ```
- **Пример ответа**:
  ```json
  {
    "id": 1,
    "title": "Мой опыт приготовления салата Цезарь",
    "content": "Сегодня я приготовил салат Цезарь по рецепту с этого сайта. Получилось очень вкусно!",
    "image_url": "http://example.com/my_caesar_salad.jpg",
    "user_id": 1,
    "created_at": "2024-06-27T12:34:56Z",
    "updated_at": null
  }
  ```

### Получение поста

- **Endpoint**: `GET /posts/{post_id}`
- **Пример ответа**: Такой же, как и при создании поста

### Обновление поста

- **Endpoint**: `PUT /posts/{post_id}`
- **Аутентификация**: Требуется (должен быть автором поста)
- **Тело запроса**: Такое же, как при создании поста, все поля опциональны
- **Пример ответа**: Такой же, как и при создании поста

### Удаление поста

- **Endpoint**: `DELETE /posts/{post_id}`
- **Аутентификация**: Требуется (должен быть автором поста)
- **Ответ**: 204 No Content

### Список постов

- **Endpoint**: `GET /posts/`
- **Параметры запроса**:
  - `skip`: Количество постов для пропуска (по умолчанию 0)
  - `limit`: Максимальное количество постов для возврата (по умолчанию 100)
- **Пример ответа**:
  ```json
  [
    {
      "id": 1,
      "title": "Мой опыт приготовления салата Цезарь",
      "content": "Сегодня я приготовил салат Цезарь по рецепту с этого сайта. Получилось очень вкусно!",
      "image_url": "http://example.com/my_caesar_salad.jpg",
      "user_id": 1,
      "created_at": "2024-06-27T12:34:56Z",
      "updated_at": null
    },
    // ... другие посты
  ]
  ```

## Обработка ошибок

API использует стандартные HTTP коды состояния для индикации успеха или неудачи запросов. Общие коды ошибок включают:

- 400 Bad Request: Неверный ввод
- 401 Unauthorized: Отсутствует или неверная аутентификация
- 403 Forbidden: Аутентифицированный пользователь не имеет доступа
- 404 Not Found: Запрашиваемый ресурс не существует
- 500 Internal Server Error: Неожиданная ошибка сервера

Ответы с ошибками будут включать JSON-тело с дополнительными деталями об ошибке.

Пример ответа с ошибкой:
```json
{
  "detail": "Recipe not found"
}
```

## Логика приложения

Приложение разработано для обмена рецептами, отслеживания диеты и взаимодействия пользователей через посты. Вот обзор основных компонентов и их взаимодействий:

1. **Управление пользователями**:
   - Пользователи регистрируются с помощью номера телефона, который верифицируется через SMS.
   - После верификации пользователи устанавливают пароль и никнейм.
   - Пользователи могут обновлять свой профиль, добавляя дополнительную информацию, такую как возраст, вес, рост и т.д.

2. **Управление рецептами**:
   - Аутентифицированные пользователи могут создавать, читать, обновлять и удалять рецепты.
   - Рецепты включают детальную информацию о питательной ценности, ингредиентах и инструкциях по приготовлению.
   - Пользователи могут искать рецепты по названию, ингредиентам или категории.

3. **Система постов**:
   - Пользователи могут создавать посты, чтобы делиться своим опытом, советами или задавать вопросы.
   - Посты могут включать текстовый контент и опциональное изображение.

4. **Отслеживание диеты** (планируется к реализации):
   - Пользователи смогут вести дневник питания, основываясь на рецептах в системе.
   - Приложение будет рассчитывать ежедневное потребление калорий и питательных веществ на основе записей в дневнике.

5. **Рекомендации** (планируется к реализации):
   - На основе профиля пользователя и целей диеты система будет рекомендовать рецепты и планы питания.

6. **Социальные функции** (планируется к реализации):
   - Пользователи смогут подписываться друг на друга, ставить лайки и комментировать посты и рецепты.

Приложение разработано с учетом возможности расширения, что позволит в будущем добавить такие функции, как планирование меню, генерация списка покупок и интеграция с устройствами для фитнес-трекинга.

## Часто задаваемые вопросы

1. **Как обновить токен доступа?**
   - В текущей версии API нет отдельного endpoint'а для обновления токена. Если токен истек, необходимо выполнить повторный вход.

2. **Какой формат следует использовать для поля `ingredients` в рецептах?**
   - Ингредиенты следует указывать в виде строки, разделяя их запятыми. Например: "мука, сахар, яйца, молоко".

3. **Как обрабатывать ошибки на стороне клиента?**
   - Всегда проверяйте код состояния HTTP ответа. Если код указывает на ошибку (4xx или 5xx), обрабатывайте ее соответствующим образом. Тело ответа будет содержать дополнительную информацию об ошибке в формате JSON.

4. **Можно ли получить рецепты конкретного пользователя?**
   - В текущей версии API такой функционал не предусмотрен. Мы планируем добавить эту возможность в будущих обновлениях.

5. **Как происходит верификация номера телефона?**
   - После отправки номера телефона пользователю отправляется SMS с кодом подтверждения. Этот код необходимо отправить обратно на сервер для завершения процесса верификации.

## Рекомендации по использованию API

1. **Обработка ошибок**: Всегда обрабатывайте возможные ошибки на стороне клиента. Это поможет создать более надежное и удобное для пользователя приложение.

2. **Кэширование**: Рассмотрите возможность кэширования часто запрашиваемых данных на стороне клиента, чтобы уменьшить количество запросов к серверу и улучшить производительность приложения.

3. **Пагинация**: При получении списков рецептов или постов всегда используйте пагинацию, чтобы избежать загрузки большого объема данных за один запрос.

4. **Валидация данных**: Перед отправкой данных на сервер выполняйте базовую валидацию на стороне клиента, чтобы уменьшить количество ошибок и улучшить пользовательский опыт.

5. **Безопасность**: Никогда не храните токены доступа в незащищенном виде. Используйте безопасные методы хранения, такие как Keychain для iOS или EncryptedSharedPreferences для Android.

6. **Версионирование**: Обратите внимание на версию API в URL. В будущем мы можем выпустить новые версии API, и вам нужно будет соответствующим образом обновить ваше приложение.

7. **Тестирование**: Тщательно тестируйте все взаимодействия с API, включая обработку ошибок и граничные случаи.

8. **Обратная связь**: Если у вас есть предложения по улучшению API или вы обнаружили ошибку, пожалуйста, сообщите об этом команде разработчиков.

## Заключение

Эта методичка предоставляет полный обзор API нашего приложения для диеты и обмена рецептами. По мере развития приложения мы будем обновлять эту документацию. Если у вас возникнут вопросы или потребуется дополнительная информация, не стесняйтесь обращаться к команде разработчиков.

Желаем вам успешной интеграции и разработки!
