# API сервиса Твой рацион

## Содержание
1. [Введение](#введение)
2. [Аутентификация](#аутентификация)
3. [Пользователи](#пользователи)
4. [Рецепты](#рецепты)
5. [Посты](#посты)
6. [Приложение](#приложение)
7. [GPT интеграция](#gpt-интеграция)
8. [Пользовательский контент](#пользовательский-контент)
9. [Обработка ошибок](#обработка-ошибок)
10. [Модели данных](#модели-данных)

## Введение

Данная методичка описывает API endpoints и логику работы приложения для диеты и обмена рецептами. API построено с использованием FastAPI и следует принципам REST.

**Базовый URL**: `http://83.166.233.215`

**Версия API**: 0.1.0

**Формат данных**: JSON

## Аутентификация

API использует OAuth2 с Bearer токенами для аутентификации.

### Запрос SMS

- **Endpoint**: `POST /request-sms`
- **Тело запроса**:
  ```json
  {
    "phone": "+79123456789"
  }
  ```
- **Ответ**: Подтверждение отправки SMS.

### Верификация SMS

- **Endpoint**: `POST /verify-sms`
- **Тело запроса**:
  ```json
  {
    "phone": "+79123456789",
    "code": "1234"
  }
  ```
- **Ответ**: Подтверждение успешной верификации.

### Регистрация пользователя

- **Endpoint**: `POST /register`
- **Тело запроса**:
  ```json
  {
    "phone": "+79123456789",
    "nickname": "user123",
    "password": "securepassword",
    "name": "Иван Иванов",
    "age": 30,
    "weight": 70.5,
    "height": 175.0,
    "gender": "male",
    "activity_level": "moderate",
    "allergies": "lactose, peanuts"
  }
  ```
- **Ответ**: Объект `UserResponse` с данными пользователя и токеном доступа.

### Получение токена доступа

- **Endpoint**: `POST /token`
- **Форма запроса**:
  - `username`: номер телефона или никнейм пользователя
  - `password`: пароль пользователя
  - `grant_type`: (опционально) тип гранта, по умолчанию "password"
  - `scope`: (опционально) область действия токена
  - `client_id`: (опционально) идентификатор клиента
  - `client_secret`: (опционально) секрет клиента
- **Ответ**: Токен доступа.

## Пользователи

### Получение информации о текущем пользователе

- **Endpoint**: `GET /users/me`
- **Аутентификация**: Требуется
- **Ответ**: Объект `UserInDB` с информацией о пользователе.

### Обновление информации о пользователе

- **Endpoint**: `PATCH /users/me`
- **Аутентификация**: Требуется
- **Тело запроса**: Объект `UserUpdate` с обновляемыми полями.
- **Ответ**: Обновленный объект `UserInDB`.

### Удаление пользователя

- **Endpoint**: `DELETE /users/me`
- **Аутентификация**: Требуется
- **Ответ**: Подтверждение успешного удаления (204 No Content).

## Рецепты

### Поиск рецептов

- **Endpoint**: `GET /recipes/search`
- **Параметры запроса**:
  - `name`: поиск по названию (опционально)
  - `ingredients`: поиск по ингредиентам (опционально)
  - `category`: поиск по категории (опционально)
- **Ответ**: Список объектов `RecipeResponse`.

### Получение категорий рецептов

- **Endpoint**: `GET /recipes/categories`
- **Ответ**: Список строк с названиями категорий.

### Создание рецепта

- **Endpoint**: `POST /recipes/`
- **Аутентификация**: Требуется
- **Тело запроса**: Объект `RecipeCreate`.
- **Ответ**: Созданный объект `RecipeResponse`.

### Список рецептов

- **Endpoint**: `GET /recipes/`
- **Параметры запроса**:
  - `skip`: количество рецептов для пропуска (по умолчанию 0)
  - `limit`: максимальное количество возвращаемых рецептов (по умолчанию 100)
- **Ответ**: Список объектов `RecipeResponse`.

### Получение рецепта

- **Endpoint**: `GET /recipes/{recipe_id}`
- **Ответ**: Объект `RecipeResponse`.

### Обновление рецепта

- **Endpoint**: `PUT /recipes/{recipe_id}`
- **Аутентификация**: Требуется
- **Тело запроса**: Объект `RecipeUpdate`.
- **Ответ**: Обновленный объект `RecipeResponse`.

### Удаление рецепта

- **Endpoint**: `DELETE /recipes/{recipe_id}`
- **Аутентификация**: Требуется
- **Ответ**: Подтверждение успешного удаления (204 No Content).

## Посты

### Создание поста

- **Endpoint**: `POST /posts/`
- **Аутентификация**: Требуется
- **Тело запроса**: Объект `PostCreate`.
- **Ответ**: Созданный объект `PostResponse`.

### Список постов

- **Endpoint**: `GET /posts/`
- **Параметры запроса**:
  - `skip`: количество постов для пропуска (по умолчанию 0)
  - `limit`: максимальное количество возвращаемых постов (по умолчанию 100)
- **Ответ**: Список объектов `PostResponse`.

### Получение поста

- **Endpoint**: `GET /posts/{post_id}`
- **Ответ**: Объект `PostResponse`.

### Обновление поста

- **Endpoint**: `PUT /posts/{post_id}`
- **Аутентификация**: Требуется
- **Тело запроса**: Объект `PostUpdate`.
- **Ответ**: Обновленный объект `PostResponse`.

### Удаление поста

- **Endpoint**: `DELETE /posts/{post_id}`
- **Аутентификация**: Требуется
- **Ответ**: Подтверждение успешного удаления (204 No Content).

## Приложение

### Получение индекса массы тела (BMI)

- **Endpoint**: `GET /app/bmi`
- **Аутентификация**: Требуется
- **Ответ**: Рассчитанный BMI пользователя.

### Получение дневной нормы калорий

- **Endpoint**: `GET /app/daily-calorie-intake`
- **Аутентификация**: Требуется
- **Ответ**: Рассчитанная дневная норма калорий для пользователя.

## GPT интеграция

### Запрос диетических рекомендаций

- **Endpoint**: `POST /gpt/diet`
- **Аутентификация**: Требуется
- **Тело запроса**: Объект `MessageRequest` с полем `message`.
- **Ответ**: Диетические рекомендации, сгенерированные GPT.

### Переписывание текста

- **Endpoint**: `POST /gpt/rewrite`
- **Аутентификация**: Требуется
- **Тело запроса**: Объект `MessageRequest` с полем `message`.
- **Ответ**: Переписанный текст, сгенерированный GPT.

## Пользовательский контент

### Получение рецептов пользователя

- **Endpoint**: `GET /user/my-recipes`
- **Аутентификация**: Требуется
- **Параметры запроса**:
  - `skip`: количество рецептов для пропуска (по умолчанию 0)
  - `limit`: максимальное количество возвращаемых рецептов (по умолчанию 100)
- **Ответ**: Список объектов `RecipeResponse`, созданных текущим пользователем.

### Получение постов пользователя

- **Endpoint**: `GET /user/my-posts`
- **Аутентификация**: Требуется
- **Параметры запроса**:
  - `skip`: количество постов для пропуска (по умолчанию 0)
  - `limit`: максимальное количество возвращаемых постов (по умолчанию 100)
- **Ответ**: Список объектов `PostResponse`, созданных текущим пользователем.

## Обработка ошибок

API использует стандартные HTTP коды состояния для индикации успеха или неудачи запросов. В случае ошибки валидации (код 422) возвращается объект `HTTPValidationError` с деталями ошибки.

## Модели данных

### UserCreate
- `phone`: строка
- `nickname`: строка
- `password`: строка (минимум 8 символов)
- `name`: строка (опционально)
- `age`: целое число (опционально)
- `weight`: число (опционально)
- `height`: число (опционально)
- `gender`: строка (опционально)
- `activity_level`: строка (опционально)
- `allergies`: строка (опционально)

### UserUpdate
- `nickname`: строка (3-20 символов, опционально)
- `name`: строка (опционально)
- `age`: целое число (0-120, опционально)
- `weight`: число (>0, опционально)
- `height`: число (>0, опционально)
- `gender`: строка (опционально)
- `activity_level`: строка (опционально)
- `allergies`: строка (опционально)

### UserInDB
- Все поля из UserCreate, кроме password
- `id`: целое число

### UserResponse
- `user`: объект UserInDB
- `access_token`: строка
- `token_type`: строка

### RecipeCreate
- `name`: строка
- `description`: строка
- `image_url`: строка
- `ingredients`: строка
- `cost`: число
- `calories`: число
- `protein`: число
- `fat`: число
- `carbohydrates`: число
- `category`: строка
- `cooking_time`: целое число
- `instructions`: строка

### RecipeUpdate
- Все поля из RecipeCreate (все опциональны)

### RecipeResponse
- Все поля из RecipeCreate
- `id`: целое число
- `user_id`: целое число

### PostCreate
- `title`: строка
- `content`: строка
- `image_url`: строка (опционально)

### PostUpdate
- Все поля из PostCreate (все опциональны)

### PostResponse
- Все поля из PostCreate
- `id`: целое число
- `user_id`: целое число
- `created_at`: дата и время
- `updated_at`: дата и время (опционально)

### MessageRequest
- `message`: строка
